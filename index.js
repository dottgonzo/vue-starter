"use strict";
var inquirer = require("inquirer");
var fs = require("fs");
var Promise = require("bluebird");
var pathExists = require("path-exists");
var _ = require("lodash");
var async = require("async");
var path = require("path");
var exec = require("promised-exec");
var cordovadir = "/tmp/cordova" + new Date().getTime();
var vuedir = "/tmp/vue" + new Date().getTime();
var gitrepo = false;
if (pathExists.sync("./.git/config")) {
    var gitcontent = fs.readFileSync("./.git/config").toString("utf-8").replace(/\t/g, '').split('\n');
    for (var i = 0; i < gitcontent.length; i++) {
        if (gitcontent[i].split('@').length > 1) {
            gitrepo = gitcontent[i].split('url = ')[1];
        }
    }
}
var questions = [
    {
        type: 'list',
        name: 'app',
        message: 'Select app model',
        choices: ['mobile', 'multi', 'desktop', 'server'],
        when: function (answers) {
            return answers.comments !== 'Nope, all good!';
        }
    },
    {
        type: 'input',
        name: 'name',
        message: 'Insert App name',
        validate: function (value) {
            var pass = 'Please enter a valid phone number';
            if (value) {
                pass = true;
            }
            return pass;
        }
    },
    {
        type: 'checkbox',
        message: 'Select platforms',
        name: 'platforms',
        when: function (answers) {
            return answers.app === 'multi';
        },
        choices: [
            {
                name: 'Browser'
            },
            {
                name: 'iOS'
            },
            {
                name: 'Android'
            },
            {
                name: 'Desktop'
            }
        ],
        validate: function (answer) {
            var a = true;
            if (answer.length < 1) {
                a = 'You must choose at least one topping.';
            }
            return a;
        }
    },
    {
        type: 'checkbox',
        message: 'Select mobile platforms',
        name: 'mobile',
        when: function (answers) {
            return answers.app === 'mobile';
        },
        choices: [
            {
                name: 'iOSMobile'
            },
            {
                name: 'Android'
            }
        ],
        validate: function (answer) {
            var a = true;
            if (answer.length < 1) {
                a = 'You must choose at least one topping.';
            }
            return a;
        }
    },
    {
        type: 'confirm',
        name: 'confirm',
        message: 'do you wan to confirm? (Y/n)',
        default: false,
        validate: function (value) {
            var ret = false;
            if (value == "yes" || value == "Yes" || value == "y" || value == "Y") {
                ret = true;
            }
            return ret;
        }
    }
];
var dir;
if (!gitrepo) {
    questions.push({
        name: "repository",
        type: "input",
        message: "Insert repository",
        validate: function (value) {
            if (value.split("@").length > 1 || value.split("ttp://") > 1) {
                return true;
            }
            return 'Please enter a valid repository';
        }
    });
}
else {
    dir = path.resolve();
}
function prompt() {
    return new Promise(function (resolve, reject) {
        inquirer.prompt(questions).then(function (answers) {
            resolve(answers);
        }).catch(function (err) {
            throw Error(err);
        });
    });
}
module.exports = function cli() {
    prompt().then(function (a) {
        if (a.confirm) {
            if (!dir)
                dir = path.resolve() + '/' + a.name;
            switch (a.app) {
                case "multi":
                    exec("cordova create " + a.name + " online.kernel." + a.name + " " + a.name).then(function () {
                        var platforms = [];
                        _.map(a.platforms, function (p) {
                            if (p.toLowerCase() === "browser" || p.toLowerCase() === "ios" || p.toLowerCase() === "android")
                                platforms.push(p.toLowerCase());
                        });
                        async.eachSeries(platforms, function (pla, cb) {
                            console.log("adding platform " + pla + " in " + dir);
                            exec("cd " + dir + " && cordova platform add " + pla + " --save").then(function () {
                                cb();
                            }).catch(function (err) {
                                cb(err);
                            });
                        }, function (err) {
                            if (err) {
                                throw err;
                            }
                            else {
                                console.log("adding vuekit to " + dir + " from " + __dirname + "/vuekit");
                                exec("cp -r " + __dirname + "/vuekit/. " + dir).then(function () {
                                    exec("cd " + dir + " npm i").then(function () {
                                        console.log("all done for now");
                                    }).catch(function (err) {
                                        throw err;
                                    });
                                }).catch(function (err) {
                                    throw err;
                                });
                            }
                        });
                    }).catch(function (err) {
                        throw err;
                    });
                    break;
                default:
                    console.log("todoooo");
                    break;
            }
        }
        else {
            console.log("Exit!");
        }
    });
};

//# sourceMappingURL=data:application/json;base64,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dkIsQ0FBQztJQUdILENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFBIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgKiBhcyBpbnF1aXJlciBmcm9tIFwiaW5xdWlyZXJcIjtcbmltcG9ydCAqIGFzIGZzIGZyb20gXCJmc1wiO1xuaW1wb3J0ICogYXMgUHJvbWlzZSBmcm9tIFwiYmx1ZWJpcmRcIjtcbmltcG9ydCAqIGFzIHBhdGhFeGlzdHMgZnJvbSBcInBhdGgtZXhpc3RzXCI7XG5pbXBvcnQgKiBhcyBjb21tYW5kZXIgZnJvbSBcImNvbW1hbmRlclwiO1xuaW1wb3J0ICogYXMgXyBmcm9tIFwibG9kYXNoXCI7XG5pbXBvcnQgKiBhcyBhc3luYyBmcm9tIFwiYXN5bmNcIjtcbmltcG9ydCAqIGFzIHBhdGggZnJvbSBcInBhdGhcIjtcblxuXG5sZXQgZXhlYyA9IHJlcXVpcmUoXCJwcm9taXNlZC1leGVjXCIpO1xuXG5pbnRlcmZhY2UgSWFueUZ1bmN0aW9uIHtcbiAgRnVuY3Rpb246IGFueTtcbn1cblxuXG5pbnRlcmZhY2UgSXF1ZXN0aW9uIHtcblxuICB0eXBlOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgbWVzc2FnZTogc3RyaW5nO1xuICBjaG9pY2VzPzogYW55W107XG4gIGRlZmF1bHQ/OiBhbnk7XG4gIHZhbGlkYXRlPzogRnVuY3Rpb247XG4gIGZpbHRlcj86IGFueTtcbiAgd2hlbj86IEZ1bmN0aW9uO1xuXG59XG5cbmxldCBjb3Jkb3ZhZGlyID0gXCIvdG1wL2NvcmRvdmFcIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xubGV0IHZ1ZWRpciA9IFwiL3RtcC92dWVcIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuXG5cblxubGV0IGdpdHJlcG86IGFueSA9IGZhbHNlO1xuXG5cbmlmIChwYXRoRXhpc3RzLnN5bmMoXCIuLy5naXQvY29uZmlnXCIpKSB7XG5cblxuICBsZXQgZ2l0Y29udGVudCA9IGZzLnJlYWRGaWxlU3luYyhcIi4vLmdpdC9jb25maWdcIikudG9TdHJpbmcoXCJ1dGYtOFwiKS5yZXBsYWNlKC9cXHQvZywgJycpLnNwbGl0KCdcXG4nKTtcblxuXG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBnaXRjb250ZW50Lmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKGdpdGNvbnRlbnRbaV0uc3BsaXQoJ0AnKS5sZW5ndGggPiAxKSB7XG4gICAgICBnaXRyZXBvID0gZ2l0Y29udGVudFtpXS5zcGxpdCgndXJsID0gJylbMV07XG4gICAgfVxuICB9XG59XG5cbmxldCBxdWVzdGlvbnMgPSA8SXF1ZXN0aW9uW10+W1xuXG4gIHtcbiAgICB0eXBlOiAnbGlzdCcsXG4gICAgbmFtZTogJ2FwcCcsXG4gICAgbWVzc2FnZTogJ1NlbGVjdCBhcHAgbW9kZWwnLFxuICAgIGNob2ljZXM6IFsnbW9iaWxlJywgJ211bHRpJywgJ2Rlc2t0b3AnLCAnc2VydmVyJ10sXG4gICAgd2hlbjogZnVuY3Rpb24gKGFuc3dlcnMpIHtcbiAgICAgIHJldHVybiBhbnN3ZXJzLmNvbW1lbnRzICE9PSAnTm9wZSwgYWxsIGdvb2QhJztcbiAgICB9XG4gIH0sXG4gIHtcbiAgICB0eXBlOiAnaW5wdXQnLFxuICAgIG5hbWU6ICduYW1lJyxcbiAgICBtZXNzYWdlOiAnSW5zZXJ0IEFwcCBuYW1lJyxcbiAgICB2YWxpZGF0ZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICBsZXQgcGFzczogYW55ID0gJ1BsZWFzZSBlbnRlciBhIHZhbGlkIHBob25lIG51bWJlcic7XG4gICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgcGFzcyA9IHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gcGFzcztcbiAgICB9XG4gIH0sXG5cbiAge1xuICAgIHR5cGU6ICdjaGVja2JveCcsXG4gICAgbWVzc2FnZTogJ1NlbGVjdCBwbGF0Zm9ybXMnLFxuICAgIG5hbWU6ICdwbGF0Zm9ybXMnLFxuICAgIHdoZW46IGZ1bmN0aW9uIChhbnN3ZXJzKSB7XG4gICAgICByZXR1cm4gYW5zd2Vycy5hcHAgPT09ICdtdWx0aSc7XG4gICAgfSxcbiAgICBjaG9pY2VzOiBbXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdCcm93c2VyJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ2lPUydcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdBbmRyb2lkJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0Rlc2t0b3AnXG4gICAgICB9XG4gICAgXSxcbiAgICB2YWxpZGF0ZTogZnVuY3Rpb24gKGFuc3dlcikge1xuICAgICAgbGV0IGE6IGFueSA9IHRydWU7XG4gICAgICBpZiAoYW5zd2VyLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgYSA9ICdZb3UgbXVzdCBjaG9vc2UgYXQgbGVhc3Qgb25lIHRvcHBpbmcuJztcbiAgICAgIH1cbiAgICAgIHJldHVybiBhO1xuICAgIH1cbiAgfSxcblxuICB7XG4gICAgdHlwZTogJ2NoZWNrYm94JyxcbiAgICBtZXNzYWdlOiAnU2VsZWN0IG1vYmlsZSBwbGF0Zm9ybXMnLFxuICAgIG5hbWU6ICdtb2JpbGUnLFxuICAgIHdoZW46IGZ1bmN0aW9uIChhbnN3ZXJzKSB7XG4gICAgICByZXR1cm4gYW5zd2Vycy5hcHAgPT09ICdtb2JpbGUnO1xuICAgIH0sXG4gICAgY2hvaWNlczogW1xuXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdpT1NNb2JpbGUnXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnQW5kcm9pZCdcbiAgICAgIH1cbiAgICBdLFxuICAgIHZhbGlkYXRlOiBmdW5jdGlvbiAoYW5zd2VyKSB7XG4gICAgICBsZXQgYTogYW55ID0gdHJ1ZTtcbiAgICAgIGlmIChhbnN3ZXIubGVuZ3RoIDwgMSkge1xuICAgICAgICBhID0gJ1lvdSBtdXN0IGNob29zZSBhdCBsZWFzdCBvbmUgdG9wcGluZy4nO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGE7XG4gICAgfVxuICB9LFxuICB7XG4gICAgdHlwZTogJ2NvbmZpcm0nLFxuICAgIG5hbWU6ICdjb25maXJtJyxcbiAgICBtZXNzYWdlOiAnZG8geW91IHdhbiB0byBjb25maXJtPyAoWS9uKScsXG4gICAgZGVmYXVsdDogZmFsc2UsXG4gICAgdmFsaWRhdGU6IGZ1bmN0aW9uICh2YWx1ZTogc3RyaW5nKTogYW55IHtcbiAgICAgIGxldCByZXQgPSBmYWxzZTtcbiAgICAgIGlmICh2YWx1ZSA9PSBcInllc1wiIHx8IHZhbHVlID09IFwiWWVzXCIgfHwgdmFsdWUgPT0gXCJ5XCIgfHwgdmFsdWUgPT0gXCJZXCIpIHtcbiAgICAgICAgcmV0ID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXQ7XG4gICAgfVxuICB9XG5cbl07XG5cblxubGV0IGRpcjogc3RyaW5nO1xuXG5pZiAoIWdpdHJlcG8pIHtcblxuICBxdWVzdGlvbnMucHVzaCh7XG4gICAgbmFtZTogXCJyZXBvc2l0b3J5XCIsXG4gICAgdHlwZTogXCJpbnB1dFwiLFxuICAgIG1lc3NhZ2U6IFwiSW5zZXJ0IHJlcG9zaXRvcnlcIixcbiAgICB2YWxpZGF0ZTogZnVuY3Rpb24gKHZhbHVlKTogYW55IHtcblxuICAgICAgaWYgKHZhbHVlLnNwbGl0KFwiQFwiKS5sZW5ndGggPiAxIHx8IHZhbHVlLnNwbGl0KFwidHRwOi8vXCIpID4gMSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuICdQbGVhc2UgZW50ZXIgYSB2YWxpZCByZXBvc2l0b3J5JztcbiAgICB9XG5cbiAgfSk7XG5cblxufSBlbHNlIHtcblxuICBkaXIgPSBwYXRoLnJlc29sdmUoKTtcblxufVxuXG5cbmZ1bmN0aW9uIHByb21wdCgpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlPGFueT4oZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuXG4gICAgaW5xdWlyZXIucHJvbXB0KHF1ZXN0aW9ucykudGhlbihmdW5jdGlvbiAoYW5zd2Vycykge1xuXG4gICAgICByZXNvbHZlKGFuc3dlcnMpO1xuICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgIHRocm93IEVycm9yKGVycik7XG5cbiAgICB9KTtcbiAgfSk7XG5cbn1cblxuZXhwb3J0ID0gZnVuY3Rpb24gY2xpKCkge1xuXG4gIHByb21wdCgpLnRoZW4oZnVuY3Rpb24gKGEpIHtcblxuICAgIGlmIChhLmNvbmZpcm0pIHtcblxuICAgICAgaWYgKCFkaXIpIGRpciA9IHBhdGgucmVzb2x2ZSgpICsgJy8nICsgYS5uYW1lO1xuXG5cbiAgICAgIHN3aXRjaCAoYS5hcHApIHtcblxuICAgICAgICBjYXNlIFwibXVsdGlcIjpcblxuICAgICAgICAgIGV4ZWMoXCJjb3Jkb3ZhIGNyZWF0ZSBcIiArIGEubmFtZSArIFwiIG9ubGluZS5rZXJuZWwuXCIgKyBhLm5hbWUgKyBcIiBcIiArIGEubmFtZSkudGhlbihmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIGxldCBwbGF0Zm9ybXMgPSBbXTtcblxuICAgICAgICAgICAgXy5tYXAoYS5wbGF0Zm9ybXMsIGZ1bmN0aW9uIChwOiBzdHJpbmcpIHtcbiAgICAgICAgICAgICAgaWYgKHAudG9Mb3dlckNhc2UoKSA9PT0gXCJicm93c2VyXCIgfHwgcC50b0xvd2VyQ2FzZSgpID09PSBcImlvc1wiIHx8IHAudG9Mb3dlckNhc2UoKSA9PT0gXCJhbmRyb2lkXCIpIHBsYXRmb3Jtcy5wdXNoKHAudG9Mb3dlckNhc2UoKSlcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIGFzeW5jLmVhY2hTZXJpZXMocGxhdGZvcm1zLCBmdW5jdGlvbiAocGxhLCBjYikge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImFkZGluZyBwbGF0Zm9ybSBcIiArIHBsYSsgXCIgaW4gXCIrZGlyKTtcbiAgICAgICAgICAgICAgZXhlYyhcImNkIFwiICsgZGlyICsgXCIgJiYgY29yZG92YSBwbGF0Zm9ybSBhZGQgXCIgKyBwbGEgKyBcIiAtLXNhdmVcIikudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY2IoKTtcbiAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgIGNiKGVycik7XG4gICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIHRocm93IGVycjtcblxuICAgICAgICAgICAgICB9IGVsc2Uge1xuXG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImFkZGluZyB2dWVraXQgdG8gXCIgKyBkaXIgKyBcIiBmcm9tIFwiICsgX19kaXJuYW1lICsgXCIvdnVla2l0XCIpO1xuXG4gICAgICAgICAgICAgICAgZXhlYyhcImNwIC1yIFwiICsgX19kaXJuYW1lICsgXCIvdnVla2l0Ly4gXCIgKyBkaXIpLnRoZW4oZnVuY3Rpb24gKCkge1xuXG5cbiAgICAgICAgICAgICAgICAgIGV4ZWMoXCJjZCBcIiArIGRpciArIFwiIG5wbSBpXCIpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImFsbCBkb25lIGZvciBub3dcIilcbiAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyXG4gICAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyXG4gICAgICAgICAgICAgICAgfSk7XG5cblxuXG5cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIHRocm93IGVycjtcblxuICAgICAgICAgIH0pXG5cbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGNvbnNvbGUubG9nKFwidG9kb29vb1wiKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkV4aXQhXCIpO1xuICAgIH1cblxuXG4gIH0pO1xufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
