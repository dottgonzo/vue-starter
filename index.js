"use strict";
var inquirer = require("inquirer");
var fs = require("fs");
var Promise = require("bluebird");
var pathExists = require("path-exists");
var _ = require("lodash");
var async = require("async");
var path = require("path");
var gitconfig = require("git-config");
var exec = require("promised-exec");
var jsonfile = require("jsonfile");
var gcs = gitconfig.sync();
var gitConfig = gcs.user;
var cordovadir = "/tmp/cordova" + new Date().getTime();
var vuedir = "/tmp/vue" + new Date().getTime();
var gitrepo = false;
var dir;
var questions = [
    {
        type: 'list',
        name: 'app',
        message: 'Select app model',
        choices: ['mobile', 'multi', 'desktop', 'server'],
        when: function (answers) {
            return answers.comments !== 'Nope, all good!';
        }
    },
    {
        type: 'input',
        name: 'name',
        message: 'Insert App name',
        validate: function (value) {
            var pass = 'Please enter a valid phone number';
            if (value) {
                pass = true;
            }
            return pass;
        }
    },
    {
        type: 'checkbox',
        message: 'Select platforms',
        name: 'platforms',
        when: function (answers) {
            return answers.app === 'multi';
        },
        choices: [
            {
                name: 'Browser'
            },
            {
                name: 'iOS'
            },
            {
                name: 'Android'
            },
            {
                name: 'Desktop'
            }
        ],
        validate: function (answer) {
            var a = true;
            if (answer.length < 1) {
                a = 'You must choose at least one topping.';
            }
            return a;
        }
    },
    {
        type: 'checkbox',
        message: 'Select mobile platforms',
        name: 'mobile',
        when: function (answers) {
            return answers.app === 'mobile';
        },
        choices: [
            {
                name: 'iOSMobile'
            },
            {
                name: 'Android'
            }
        ],
        validate: function (answer) {
            var a = true;
            if (answer.length < 1) {
                a = 'You must choose at least one topping.';
            }
            return a;
        }
    }
];
if (pathExists.sync("./.git/config")) {
    var gitcontent = fs.readFileSync("./.git/config").toString("utf-8").replace(/\t/g, '').split('\n');
    for (var i = 0; i < gitcontent.length; i++) {
        if (gitcontent[i].split('@').length > 1) {
            gitrepo = gitcontent[i].split('url = ')[1];
        }
    }
}
if (!gitrepo) {
    questions.push({
        name: "repository",
        type: "input",
        message: "Insert repository",
        validate: function (value) {
            if (value.split("@").length > 1 || value.split("ttp://") > 1) {
                return true;
            }
            return 'Please enter a valid repository';
        }
    });
}
else {
    dir = path.resolve();
}
questions.push({
    type: 'confirm',
    name: 'confirm',
    message: 'do you wan to confirm? (Y/n)',
    default: false,
    validate: function (value) {
        var ret = false;
        if (value == "yes" || value == "Yes" || value == "y" || value == "Y") {
            ret = true;
        }
        return ret;
    }
});
function prompt() {
    return new Promise(function (resolve, reject) {
        inquirer.prompt(questions).then(function (answers) {
            resolve(answers);
        }).catch(function (err) {
            throw Error(err);
        });
    });
}
module.exports = function cli() {
    prompt().then(function (a) {
        if (a.confirm) {
            if (!dir)
                dir = path.resolve() + '/' + a.name;
            switch (a.app) {
                case "multi":
                    exec("cordova create " + a.name + " online.kernel." + a.name + " " + a.name).then(function () {
                        var platforms = [];
                        _.map(a.platforms, function (p) {
                            if (p.toLowerCase() === "browser" || p.toLowerCase() === "ios" || p.toLowerCase() === "android")
                                platforms.push(p.toLowerCase());
                        });
                        async.eachSeries(platforms, function (pla, cb) {
                            console.log("adding platform " + pla + " in " + dir);
                            exec("cd " + dir + " && cordova platform add " + pla + " --save").then(function () {
                                cb();
                            }).catch(function (err) {
                                cb(err);
                            });
                        }, function (err) {
                            if (err) {
                                throw err;
                            }
                            else {
                                console.log("adding vuekit to " + dir + " from " + __dirname + "/vuekit");
                                exec("cp -r " + __dirname + "/vuekit/. " + dir).then(function () {
                                    var pk = require(dir + "/package.json");
                                    pk.name = a.name;
                                    pk.author = gitConfig.name + " <" + gitConfig.email + ">";
                                    pk.license = "SEE LICENSE IN LICENSE";
                                    jsonfile.writeFileSync(dir + "/package.json", pk, { spaces: 4 });
                                    fs.writeFileSync(dir + "/LICENSE", '(c) Copyright ' + new Date().getFullYear() + ' kernel.online, all rights reserved.');
                                    exec("cd " + dir + " && npm i").then(function () {
                                        console.log("all done for now");
                                    }).catch(function (err) {
                                        throw err;
                                    });
                                }).catch(function (err) {
                                    throw err;
                                });
                            }
                        });
                    }).catch(function (err) {
                        throw err;
                    });
                    break;
                default:
                    console.log("todoooo");
                    break;
            }
        }
        else {
            console.log("Exit!");
        }
    });
};

//# sourceMappingURL=data:application/json;base64,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QUFHLFVBQVUsRUFBRSxnQkFBZ0IsR0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxHQUFDLHNDQUFzQyxDQUFDLENBQUM7b0NBR3JILElBQUksQ0FBQyxLQUFLLEdBQUcsR0FBRyxHQUFHLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQzt3Q0FDbkMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFBO29DQUNqQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBVSxHQUFHO3dDQUNwQixNQUFNLEdBQUcsQ0FBQTtvQ0FDWCxDQUFDLENBQUMsQ0FBQztnQ0FHTCxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBVSxHQUFHO29DQUNwQixNQUFNLEdBQUcsQ0FBQTtnQ0FDWCxDQUFDLENBQUMsQ0FBQzs0QkFLTCxDQUFDO3dCQUNILENBQUMsQ0FBQyxDQUFBO29CQUVKLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFVLEdBQUc7d0JBQ3BCLE1BQU0sR0FBRyxDQUFDO29CQUVaLENBQUMsQ0FBQyxDQUFBO29CQUVGLEtBQUssQ0FBQztnQkFFUjtvQkFDRSxPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDO29CQUN2QixLQUFLLENBQUM7WUFFVixDQUFDO1FBQ0gsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN2QixDQUFDO0lBR0gsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUEiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCAqIGFzIGlucXVpcmVyIGZyb20gXCJpbnF1aXJlclwiO1xuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzXCI7XG5pbXBvcnQgKiBhcyBQcm9taXNlIGZyb20gXCJibHVlYmlyZFwiO1xuaW1wb3J0ICogYXMgcGF0aEV4aXN0cyBmcm9tIFwicGF0aC1leGlzdHNcIjtcbmltcG9ydCAqIGFzIGNvbW1hbmRlciBmcm9tIFwiY29tbWFuZGVyXCI7XG5pbXBvcnQgKiBhcyBfIGZyb20gXCJsb2Rhc2hcIjtcbmltcG9ydCAqIGFzIGFzeW5jIGZyb20gXCJhc3luY1wiO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tIFwicGF0aFwiO1xuaW1wb3J0ICogYXMgZ2l0Y29uZmlnIGZyb20gXCJnaXQtY29uZmlnXCI7XG5pbXBvcnQgKiBhcyBwcm9ncmFtIGZyb20gXCJjb21tYW5kZXJcIjtcblxuXG5sZXQgZXhlYyA9IHJlcXVpcmUoXCJwcm9taXNlZC1leGVjXCIpO1xuXG5sZXQganNvbmZpbGUgPSByZXF1aXJlKFwianNvbmZpbGVcIik7XG5cblxuXG5cbmludGVyZmFjZSBJYW55RnVuY3Rpb24ge1xuICBGdW5jdGlvbjogYW55O1xufVxuXG5cbmludGVyZmFjZSBJcXVlc3Rpb24ge1xuXG4gIHR5cGU6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIGNob2ljZXM/OiBhbnlbXTtcbiAgZGVmYXVsdD86IGFueTtcbiAgdmFsaWRhdGU/OiBGdW5jdGlvbjtcbiAgZmlsdGVyPzogYW55O1xuICB3aGVuPzogRnVuY3Rpb247XG5cbn1cblxuXG5cbmxldCBnY3MgPSA8YW55PmdpdGNvbmZpZy5zeW5jKCk7XG5cbmxldCBnaXRDb25maWcgPSA8eyBuYW1lOiBzdHJpbmc7IGVtYWlsOiBzdHJpbmcgfT5nY3MudXNlcjsgLy8gY2FuIHBhc3MgZXhwbGl0IGZpbGUgaWYgeW91IHdhbnQgYXMgd2VsbCBcblxubGV0IGNvcmRvdmFkaXIgPSBcIi90bXAvY29yZG92YVwiICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5sZXQgdnVlZGlyID0gXCIvdG1wL3Z1ZVwiICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cblxuXG5sZXQgZ2l0cmVwbzogYW55ID0gZmFsc2U7XG5cbmxldCBkaXI6IHN0cmluZztcblxuXG5cbmxldCBxdWVzdGlvbnMgPSA8SXF1ZXN0aW9uW10+W1xuXG4gIHtcbiAgICB0eXBlOiAnbGlzdCcsXG4gICAgbmFtZTogJ2FwcCcsXG4gICAgbWVzc2FnZTogJ1NlbGVjdCBhcHAgbW9kZWwnLFxuICAgIGNob2ljZXM6IFsnbW9iaWxlJywgJ211bHRpJywgJ2Rlc2t0b3AnLCAnc2VydmVyJ10sXG4gICAgd2hlbjogZnVuY3Rpb24gKGFuc3dlcnMpIHtcbiAgICAgIHJldHVybiBhbnN3ZXJzLmNvbW1lbnRzICE9PSAnTm9wZSwgYWxsIGdvb2QhJztcbiAgICB9XG4gIH0sXG4gIHtcbiAgICB0eXBlOiAnaW5wdXQnLFxuICAgIG5hbWU6ICduYW1lJyxcbiAgICBtZXNzYWdlOiAnSW5zZXJ0IEFwcCBuYW1lJyxcbiAgICB2YWxpZGF0ZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICBsZXQgcGFzczogYW55ID0gJ1BsZWFzZSBlbnRlciBhIHZhbGlkIHBob25lIG51bWJlcic7XG4gICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgcGFzcyA9IHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gcGFzcztcbiAgICB9XG4gIH0sXG5cbiAge1xuICAgIHR5cGU6ICdjaGVja2JveCcsXG4gICAgbWVzc2FnZTogJ1NlbGVjdCBwbGF0Zm9ybXMnLFxuICAgIG5hbWU6ICdwbGF0Zm9ybXMnLFxuICAgIHdoZW46IGZ1bmN0aW9uIChhbnN3ZXJzKSB7XG4gICAgICByZXR1cm4gYW5zd2Vycy5hcHAgPT09ICdtdWx0aSc7XG4gICAgfSxcbiAgICBjaG9pY2VzOiBbXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdCcm93c2VyJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ2lPUydcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdBbmRyb2lkJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0Rlc2t0b3AnXG4gICAgICB9XG4gICAgXSxcbiAgICB2YWxpZGF0ZTogZnVuY3Rpb24gKGFuc3dlcikge1xuICAgICAgbGV0IGE6IGFueSA9IHRydWU7XG4gICAgICBpZiAoYW5zd2VyLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgYSA9ICdZb3UgbXVzdCBjaG9vc2UgYXQgbGVhc3Qgb25lIHRvcHBpbmcuJztcbiAgICAgIH1cbiAgICAgIHJldHVybiBhO1xuICAgIH1cbiAgfSxcblxuICB7XG4gICAgdHlwZTogJ2NoZWNrYm94JyxcbiAgICBtZXNzYWdlOiAnU2VsZWN0IG1vYmlsZSBwbGF0Zm9ybXMnLFxuICAgIG5hbWU6ICdtb2JpbGUnLFxuICAgIHdoZW46IGZ1bmN0aW9uIChhbnN3ZXJzKSB7XG4gICAgICByZXR1cm4gYW5zd2Vycy5hcHAgPT09ICdtb2JpbGUnO1xuICAgIH0sXG4gICAgY2hvaWNlczogW1xuXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdpT1NNb2JpbGUnXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnQW5kcm9pZCdcbiAgICAgIH1cbiAgICBdLFxuICAgIHZhbGlkYXRlOiBmdW5jdGlvbiAoYW5zd2VyKSB7XG4gICAgICBsZXQgYTogYW55ID0gdHJ1ZTtcbiAgICAgIGlmIChhbnN3ZXIubGVuZ3RoIDwgMSkge1xuICAgICAgICBhID0gJ1lvdSBtdXN0IGNob29zZSBhdCBsZWFzdCBvbmUgdG9wcGluZy4nO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGE7XG4gICAgfVxuICB9XG5cbl07XG5cblxuaWYgKHBhdGhFeGlzdHMuc3luYyhcIi4vLmdpdC9jb25maWdcIikpIHtcblxuXG4gIGxldCBnaXRjb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKFwiLi8uZ2l0L2NvbmZpZ1wiKS50b1N0cmluZyhcInV0Zi04XCIpLnJlcGxhY2UoL1xcdC9nLCAnJykuc3BsaXQoJ1xcbicpO1xuXG5cblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGdpdGNvbnRlbnQubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoZ2l0Y29udGVudFtpXS5zcGxpdCgnQCcpLmxlbmd0aCA+IDEpIHtcbiAgICAgIGdpdHJlcG8gPSBnaXRjb250ZW50W2ldLnNwbGl0KCd1cmwgPSAnKVsxXTtcbiAgICB9XG4gIH1cblxufVxuXG5cbmlmICghZ2l0cmVwbykge1xuXG5cbiAgcXVlc3Rpb25zLnB1c2goe1xuICAgIG5hbWU6IFwicmVwb3NpdG9yeVwiLFxuICAgIHR5cGU6IFwiaW5wdXRcIixcbiAgICBtZXNzYWdlOiBcIkluc2VydCByZXBvc2l0b3J5XCIsXG4gICAgdmFsaWRhdGU6IGZ1bmN0aW9uICh2YWx1ZSk6IGFueSB7XG5cbiAgICAgIGlmICh2YWx1ZS5zcGxpdChcIkBcIikubGVuZ3RoID4gMSB8fCB2YWx1ZS5zcGxpdChcInR0cDovL1wiKSA+IDEpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAnUGxlYXNlIGVudGVyIGEgdmFsaWQgcmVwb3NpdG9yeSc7XG4gICAgfVxuXG4gIH0pO1xuXG5cbn0gZWxzZSB7XG5cbiAgZGlyID0gcGF0aC5yZXNvbHZlKCk7XG5cbn1cblxuXG5cbnF1ZXN0aW9ucy5wdXNoKHtcbiAgdHlwZTogJ2NvbmZpcm0nLFxuICBuYW1lOiAnY29uZmlybScsXG4gIG1lc3NhZ2U6ICdkbyB5b3Ugd2FuIHRvIGNvbmZpcm0/IChZL24pJyxcbiAgZGVmYXVsdDogZmFsc2UsXG4gIHZhbGlkYXRlOiBmdW5jdGlvbiAodmFsdWU6IHN0cmluZyk6IGFueSB7XG4gICAgbGV0IHJldCA9IGZhbHNlO1xuICAgIGlmICh2YWx1ZSA9PSBcInllc1wiIHx8IHZhbHVlID09IFwiWWVzXCIgfHwgdmFsdWUgPT0gXCJ5XCIgfHwgdmFsdWUgPT0gXCJZXCIpIHtcbiAgICAgIHJldCA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiByZXQ7XG4gIH1cbn0pO1xuXG5cblxuZnVuY3Rpb24gcHJvbXB0KCkge1xuICByZXR1cm4gbmV3IFByb21pc2U8YW55PihmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cbiAgICBpbnF1aXJlci5wcm9tcHQocXVlc3Rpb25zKS50aGVuKGZ1bmN0aW9uIChhbnN3ZXJzKSB7XG5cbiAgICAgIHJlc29sdmUoYW5zd2Vycyk7XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgdGhyb3cgRXJyb3IoZXJyKTtcblxuICAgIH0pO1xuICB9KTtcblxufVxuXG5leHBvcnQgPSBmdW5jdGlvbiBjbGkoKSB7XG5cbiAgcHJvbXB0KCkudGhlbihmdW5jdGlvbiAoYSkge1xuXG4gICAgaWYgKGEuY29uZmlybSkge1xuXG4gICAgICBpZiAoIWRpcikgZGlyID0gcGF0aC5yZXNvbHZlKCkgKyAnLycgKyBhLm5hbWU7XG5cblxuICAgICAgc3dpdGNoIChhLmFwcCkge1xuXG4gICAgICAgIGNhc2UgXCJtdWx0aVwiOlxuXG4gICAgICAgICAgZXhlYyhcImNvcmRvdmEgY3JlYXRlIFwiICsgYS5uYW1lICsgXCIgb25saW5lLmtlcm5lbC5cIiArIGEubmFtZSArIFwiIFwiICsgYS5uYW1lKS50aGVuKGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgbGV0IHBsYXRmb3JtcyA9IFtdO1xuXG4gICAgICAgICAgICBfLm1hcChhLnBsYXRmb3JtcywgZnVuY3Rpb24gKHA6IHN0cmluZykge1xuICAgICAgICAgICAgICBpZiAocC50b0xvd2VyQ2FzZSgpID09PSBcImJyb3dzZXJcIiB8fCBwLnRvTG93ZXJDYXNlKCkgPT09IFwiaW9zXCIgfHwgcC50b0xvd2VyQ2FzZSgpID09PSBcImFuZHJvaWRcIikgcGxhdGZvcm1zLnB1c2gocC50b0xvd2VyQ2FzZSgpKVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgYXN5bmMuZWFjaFNlcmllcyhwbGF0Zm9ybXMsIGZ1bmN0aW9uIChwbGEsIGNiKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiYWRkaW5nIHBsYXRmb3JtIFwiICsgcGxhICsgXCIgaW4gXCIgKyBkaXIpO1xuICAgICAgICAgICAgICBleGVjKFwiY2QgXCIgKyBkaXIgKyBcIiAmJiBjb3Jkb3ZhIHBsYXRmb3JtIGFkZCBcIiArIHBsYSArIFwiIC0tc2F2ZVwiKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjYigpO1xuICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgY2IoZXJyKTtcbiAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuXG4gICAgICAgICAgICAgIH0gZWxzZSB7XG5cblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiYWRkaW5nIHZ1ZWtpdCB0byBcIiArIGRpciArIFwiIGZyb20gXCIgKyBfX2Rpcm5hbWUgKyBcIi92dWVraXRcIik7XG5cbiAgICAgICAgICAgICAgICBleGVjKFwiY3AgLXIgXCIgKyBfX2Rpcm5hbWUgKyBcIi92dWVraXQvLiBcIiArIGRpcikudGhlbihmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgIGxldCBwayA9IHJlcXVpcmUoZGlyICsgXCIvcGFja2FnZS5qc29uXCIpO1xuXG4gICAgICAgICAgICAgICAgICBway5uYW1lID0gYS5uYW1lO1xuICAgICAgICAgICAgICAgICAgcGsuYXV0aG9yID0gZ2l0Q29uZmlnLm5hbWUgKyBcIiA8XCIgKyBnaXRDb25maWcuZW1haWwgKyBcIj5cIjtcbiAgICAgICAgICAgICAgICAgIHBrLmxpY2Vuc2UgPSBcIlNFRSBMSUNFTlNFIElOIExJQ0VOU0VcIjtcblxuICAgICAgICAgICAgICAgICAganNvbmZpbGUud3JpdGVGaWxlU3luYyhkaXIgKyBcIi9wYWNrYWdlLmpzb25cIiwgcGssIHsgc3BhY2VzOiA0IH0pXG5cbiAgICAgICAgICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmMoZGlyICsgXCIvTElDRU5TRVwiLCAnKGMpIENvcHlyaWdodCAnK25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSsnIGtlcm5lbC5vbmxpbmUsIGFsbCByaWdodHMgcmVzZXJ2ZWQuJyk7XG5cblxuICAgICAgICAgICAgICAgICAgZXhlYyhcImNkIFwiICsgZGlyICsgXCIgJiYgbnBtIGlcIikudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiYWxsIGRvbmUgZm9yIG5vd1wiKVxuICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJcbiAgICAgICAgICAgICAgICAgIH0pO1xuXG5cbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICB0aHJvdyBlcnJcbiAgICAgICAgICAgICAgICB9KTtcblxuXG5cblxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgdGhyb3cgZXJyO1xuXG4gICAgICAgICAgfSlcblxuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgY29uc29sZS5sb2coXCJ0b2Rvb29vXCIpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiRXhpdCFcIik7XG4gICAgfVxuXG5cbiAgfSk7XG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
