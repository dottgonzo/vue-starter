"use strict";
var inquirer = require("inquirer");
var fs = require("fs");
var Promise = require("bluebird");
var pathExists = require("path-exists");
var _ = require("lodash");
var async = require("async");
var exec = require("promised-exec");
var cordovadir = "/tmp/cordova" + new Date().getTime();
var vuedir = "/tmp/vue" + new Date().getTime();
var gitrepo = false;
if (pathExists.sync("./.git/config")) {
    var gitcontent = fs.readFileSync("./.git/config").toString("utf-8").replace(/\t/g, '').split('\n');
    for (var i = 0; i < gitcontent.length; i++) {
        if (gitcontent[i].split('@').length > 1) {
            gitrepo = gitcontent[i].split('url = ')[1];
        }
    }
}
var questions = [
    {
        type: 'list',
        name: 'app',
        message: 'For leaving a comment, you get a freebie',
        choices: ['web', 'mobile', 'multi', 'desktop'],
        when: function (answers) {
            return answers.comments !== 'Nope, all good!';
        }
    },
    {
        type: 'input',
        name: 'name',
        message: 'Insert App name',
        validate: function (value) {
            var pass = 'Please enter a valid phone number';
            if (value) {
                pass = true;
            }
            return pass;
        }
    },
    {
        type: 'checkbox',
        message: 'Select platforms',
        name: 'platforms',
        when: function (answers) {
            return answers.app === 'multi';
        },
        choices: [
            {
                name: 'Browser'
            },
            {
                name: 'iOS'
            },
            {
                name: 'Android'
            },
            {
                name: 'Desktop'
            }
        ],
        validate: function (answer) {
            var a = true;
            if (answer.length < 1) {
                a = 'You must choose at least one topping.';
            }
            return a;
        }
    },
    {
        type: 'checkbox',
        message: 'Select mobile platforms',
        name: 'mobile',
        when: function (answers) {
            return answers.app === 'mobile';
        },
        choices: [
            {
                name: 'iOSMobile'
            },
            {
                name: 'Android'
            }
        ],
        validate: function (answer) {
            var a = true;
            if (answer.length < 1) {
                a = 'You must choose at least one topping.';
            }
            return a;
        }
    },
    {
        type: 'confirm',
        name: 'confirm',
        message: 'do you wan to confirm? (Y/n)',
        default: false,
        validate: function (value) {
            var ret = false;
            if (value == "yes" || value == "Yes" || value == "y" || value == "Y") {
                ret = true;
            }
            return ret;
        }
    }
];
var dir;
if (!gitrepo) {
    questions.push({
        name: "repository",
        type: "input",
        message: "Insert repository",
        validate: function (value) {
            if (value.split("@").length > 1 || value.split("ttp://") > 1) {
                return true;
            }
            return 'Please enter a valid repository';
        }
    });
}
else {
    dir = __dirname;
}
function prompt() {
    return new Promise(function (resolve, reject) {
        inquirer.prompt(questions).then(function (answers) {
            resolve(answers);
        }).catch(function (err) {
            throw Error(err);
        });
    });
}
prompt().then(function (a) {
    if (a.confirm) {
        if (!dir)
            dir = __dirname + '/' + a.name;
        switch (a.app) {
            case "multi":
                exec("cordova create " + a.name + " online.kernel." + name + " " + name).then(function () {
                    var platforms = [];
                    _.map(a.platforms, function (p) {
                        if (p.toLowerCase() === "browser" || p.toLowerCase() === "ios" || p.toLowerCase() === "android")
                            platforms.push(p.toLowerCase());
                    });
                    async.eachSeries(platforms, function (pla, cb) {
                        exec("cordova add " + pla + " --save").then(function () {
                            cb();
                        }).catch(function (err) {
                            cb(err);
                        });
                    }, function (err) {
                        if (err) {
                            throw err;
                        }
                        else {
                            exec("cp -a " + __dirname + "/vuekit" + dir).then(function () {
                                exec("cd " + dir + " npm i").then(function () {
                                    console.log("all done for now");
                                }).catch(function (err) {
                                    throw err;
                                });
                            }).catch(function (err) {
                                throw err;
                            });
                        }
                    });
                }).catch(function (err) {
                    throw err;
                });
                break;
            default:
                console.log("todoooo");
                break;
        }
    }
    else {
        console.log("Exit!");
    }
});

//# sourceMappingURL=data:application/json;base64,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TixJQUFJLENBQUMsUUFBUSxHQUFHLFNBQVMsR0FBRyxTQUFTLEdBQUcsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dDQUdoRCxJQUFJLENBQUMsS0FBSyxHQUFHLEdBQUcsR0FBRyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUM7b0NBQ2hDLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsQ0FBQTtnQ0FDakMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVUsR0FBRztvQ0FDcEIsTUFBTSxHQUFHLENBQUE7Z0NBQ1gsQ0FBQyxDQUFDLENBQUM7NEJBR0wsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVUsR0FBRztnQ0FDcEIsTUFBTSxHQUFHLENBQUE7NEJBQ1gsQ0FBQyxDQUFDLENBQUM7d0JBS0wsQ0FBQztvQkFDSCxDQUFDLENBQUMsQ0FBQTtnQkFFSixDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBVSxHQUFHO29CQUNwQixNQUFNLEdBQUcsQ0FBQztnQkFFWixDQUFDLENBQUMsQ0FBQTtnQkFFRixLQUFLLENBQUM7WUFFUjtnQkFDRSxPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUN2QixLQUFLLENBQUM7UUFFVixDQUFDO0lBQ0gsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN2QixDQUFDO0FBR0gsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCAqIGFzIGlucXVpcmVyIGZyb20gXCJpbnF1aXJlclwiO1xuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzXCI7XG5pbXBvcnQgKiBhcyBQcm9taXNlIGZyb20gXCJibHVlYmlyZFwiO1xuaW1wb3J0ICogYXMgcGF0aEV4aXN0cyBmcm9tIFwicGF0aC1leGlzdHNcIjtcbmltcG9ydCAqIGFzIGNvbW1hbmRlciBmcm9tIFwiY29tbWFuZGVyXCI7XG5pbXBvcnQgKiBhcyBfIGZyb20gXCJsb2Rhc2hcIjtcbmltcG9ydCAqIGFzIGFzeW5jIGZyb20gXCJhc3luY1wiO1xuXG5cbmxldCBleGVjID0gcmVxdWlyZShcInByb21pc2VkLWV4ZWNcIik7XG5cbmludGVyZmFjZSBJYW55RnVuY3Rpb24ge1xuICBGdW5jdGlvbjogYW55O1xufVxuXG5cbmludGVyZmFjZSBJcXVlc3Rpb24ge1xuXG4gIHR5cGU6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIGNob2ljZXM/OiBhbnlbXTtcbiAgZGVmYXVsdD86IGFueTtcbiAgdmFsaWRhdGU/OiBGdW5jdGlvbjtcbiAgZmlsdGVyPzogYW55O1xuICB3aGVuPzogRnVuY3Rpb247XG5cbn1cblxubGV0IGNvcmRvdmFkaXIgPSBcIi90bXAvY29yZG92YVwiICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5sZXQgdnVlZGlyID0gXCIvdG1wL3Z1ZVwiICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cblxuXG5sZXQgZ2l0cmVwbzogYW55ID0gZmFsc2U7XG5cblxuaWYgKHBhdGhFeGlzdHMuc3luYyhcIi4vLmdpdC9jb25maWdcIikpIHtcblxuXG4gIGxldCBnaXRjb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKFwiLi8uZ2l0L2NvbmZpZ1wiKS50b1N0cmluZyhcInV0Zi04XCIpLnJlcGxhY2UoL1xcdC9nLCAnJykuc3BsaXQoJ1xcbicpO1xuXG5cblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGdpdGNvbnRlbnQubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoZ2l0Y29udGVudFtpXS5zcGxpdCgnQCcpLmxlbmd0aCA+IDEpIHtcbiAgICAgIGdpdHJlcG8gPSBnaXRjb250ZW50W2ldLnNwbGl0KCd1cmwgPSAnKVsxXTtcbiAgICB9XG4gIH1cbn1cblxubGV0IHF1ZXN0aW9ucyA9IDxJcXVlc3Rpb25bXT5bXG5cbiAge1xuICAgIHR5cGU6ICdsaXN0JyxcbiAgICBuYW1lOiAnYXBwJyxcbiAgICBtZXNzYWdlOiAnRm9yIGxlYXZpbmcgYSBjb21tZW50LCB5b3UgZ2V0IGEgZnJlZWJpZScsXG4gICAgY2hvaWNlczogWyd3ZWInLCAnbW9iaWxlJywgJ211bHRpJywgJ2Rlc2t0b3AnXSxcbiAgICB3aGVuOiBmdW5jdGlvbiAoYW5zd2Vycykge1xuICAgICAgcmV0dXJuIGFuc3dlcnMuY29tbWVudHMgIT09ICdOb3BlLCBhbGwgZ29vZCEnO1xuICAgIH1cbiAgfSxcbiAge1xuICAgIHR5cGU6ICdpbnB1dCcsXG4gICAgbmFtZTogJ25hbWUnLFxuICAgIG1lc3NhZ2U6ICdJbnNlcnQgQXBwIG5hbWUnLFxuICAgIHZhbGlkYXRlOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIGxldCBwYXNzOiBhbnkgPSAnUGxlYXNlIGVudGVyIGEgdmFsaWQgcGhvbmUgbnVtYmVyJztcbiAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICBwYXNzID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwYXNzO1xuICAgIH1cbiAgfSxcblxuICB7XG4gICAgdHlwZTogJ2NoZWNrYm94JyxcbiAgICBtZXNzYWdlOiAnU2VsZWN0IHBsYXRmb3JtcycsXG4gICAgbmFtZTogJ3BsYXRmb3JtcycsXG4gICAgd2hlbjogZnVuY3Rpb24gKGFuc3dlcnMpIHtcbiAgICAgIHJldHVybiBhbnN3ZXJzLmFwcCA9PT0gJ211bHRpJztcbiAgICB9LFxuICAgIGNob2ljZXM6IFtcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0Jyb3dzZXInXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnaU9TJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ0FuZHJvaWQnXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnRGVza3RvcCdcbiAgICAgIH1cbiAgICBdLFxuICAgIHZhbGlkYXRlOiBmdW5jdGlvbiAoYW5zd2VyKSB7XG4gICAgICBsZXQgYTogYW55ID0gdHJ1ZTtcbiAgICAgIGlmIChhbnN3ZXIubGVuZ3RoIDwgMSkge1xuICAgICAgICBhID0gJ1lvdSBtdXN0IGNob29zZSBhdCBsZWFzdCBvbmUgdG9wcGluZy4nO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGE7XG4gICAgfVxuICB9LFxuXG4gIHtcbiAgICB0eXBlOiAnY2hlY2tib3gnLFxuICAgIG1lc3NhZ2U6ICdTZWxlY3QgbW9iaWxlIHBsYXRmb3JtcycsXG4gICAgbmFtZTogJ21vYmlsZScsXG4gICAgd2hlbjogZnVuY3Rpb24gKGFuc3dlcnMpIHtcbiAgICAgIHJldHVybiBhbnN3ZXJzLmFwcCA9PT0gJ21vYmlsZSc7XG4gICAgfSxcbiAgICBjaG9pY2VzOiBbXG5cbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ2lPU01vYmlsZSdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdBbmRyb2lkJ1xuICAgICAgfVxuICAgIF0sXG4gICAgdmFsaWRhdGU6IGZ1bmN0aW9uIChhbnN3ZXIpIHtcbiAgICAgIGxldCBhOiBhbnkgPSB0cnVlO1xuICAgICAgaWYgKGFuc3dlci5sZW5ndGggPCAxKSB7XG4gICAgICAgIGEgPSAnWW91IG11c3QgY2hvb3NlIGF0IGxlYXN0IG9uZSB0b3BwaW5nLic7XG4gICAgICB9XG4gICAgICByZXR1cm4gYTtcbiAgICB9XG4gIH0sXG5cbiAge1xuICAgIHR5cGU6ICdjb25maXJtJyxcbiAgICBuYW1lOiAnY29uZmlybScsXG4gICAgbWVzc2FnZTogJ2RvIHlvdSB3YW4gdG8gY29uZmlybT8gKFkvbiknLFxuICAgIGRlZmF1bHQ6IGZhbHNlLFxuICAgIHZhbGlkYXRlOiBmdW5jdGlvbiAodmFsdWU6IHN0cmluZyk6IGFueSB7XG4gICAgICBsZXQgcmV0ID0gZmFsc2U7XG4gICAgICBpZiAodmFsdWUgPT0gXCJ5ZXNcIiB8fCB2YWx1ZSA9PSBcIlllc1wiIHx8IHZhbHVlID09IFwieVwiIHx8IHZhbHVlID09IFwiWVwiKSB7XG4gICAgICAgIHJldCA9IHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmV0O1xuICAgIH1cbiAgfVxuXG5dO1xuXG5cbmxldCBkaXI6IHN0cmluZztcblxuaWYgKCFnaXRyZXBvKSB7XG5cbiAgcXVlc3Rpb25zLnB1c2goe1xuICAgIG5hbWU6IFwicmVwb3NpdG9yeVwiLFxuICAgIHR5cGU6IFwiaW5wdXRcIixcbiAgICBtZXNzYWdlOiBcIkluc2VydCByZXBvc2l0b3J5XCIsXG4gICAgdmFsaWRhdGU6IGZ1bmN0aW9uICh2YWx1ZSk6IGFueSB7XG5cbiAgICAgIGlmICh2YWx1ZS5zcGxpdChcIkBcIikubGVuZ3RoID4gMSB8fCB2YWx1ZS5zcGxpdChcInR0cDovL1wiKSA+IDEpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAnUGxlYXNlIGVudGVyIGEgdmFsaWQgcmVwb3NpdG9yeSc7XG4gICAgfVxuXG4gIH0pO1xuXG5cbn0gZWxzZSB7XG5cbiAgZGlyID0gX19kaXJuYW1lO1xuXG59XG5cblxuZnVuY3Rpb24gcHJvbXB0KCkge1xuICByZXR1cm4gbmV3IFByb21pc2U8YW55PihmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG5cbiAgICBpbnF1aXJlci5wcm9tcHQocXVlc3Rpb25zKS50aGVuKGZ1bmN0aW9uIChhbnN3ZXJzKSB7XG5cbiAgICAgIHJlc29sdmUoYW5zd2Vycyk7XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgdGhyb3cgRXJyb3IoZXJyKTtcblxuICAgIH0pO1xuICB9KTtcblxufVxuXG5cbnByb21wdCgpLnRoZW4oZnVuY3Rpb24gKGEpIHtcblxuICBpZiAoYS5jb25maXJtKSB7XG5cbiAgICBpZiAoIWRpcikgZGlyID0gX19kaXJuYW1lICsgJy8nICsgYS5uYW1lO1xuXG5cbiAgICBzd2l0Y2ggKGEuYXBwKSB7XG5cbiAgICAgIGNhc2UgXCJtdWx0aVwiOlxuXG4gICAgICAgIGV4ZWMoXCJjb3Jkb3ZhIGNyZWF0ZSBcIiArIGEubmFtZSArIFwiIG9ubGluZS5rZXJuZWwuXCIgKyBuYW1lICsgXCIgXCIgKyBuYW1lKS50aGVuKGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgIGxldCBwbGF0Zm9ybXMgPSBbXTtcblxuICAgICAgICAgIF8ubWFwKGEucGxhdGZvcm1zLCBmdW5jdGlvbiAocDogc3RyaW5nKSB7XG4gICAgICAgICAgICBpZiAocC50b0xvd2VyQ2FzZSgpID09PSBcImJyb3dzZXJcIiB8fCBwLnRvTG93ZXJDYXNlKCkgPT09IFwiaW9zXCIgfHwgcC50b0xvd2VyQ2FzZSgpID09PSBcImFuZHJvaWRcIikgcGxhdGZvcm1zLnB1c2gocC50b0xvd2VyQ2FzZSgpKVxuICAgICAgICAgIH0pXG5cbiAgICAgICAgICBhc3luYy5lYWNoU2VyaWVzKHBsYXRmb3JtcywgZnVuY3Rpb24gKHBsYSwgY2IpIHtcbiAgICAgICAgICAgIGV4ZWMoXCJjb3Jkb3ZhIGFkZCBcIiArIHBsYSArIFwiIC0tc2F2ZVwiKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgY2IoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgY2IoZXJyKTtcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgIHRocm93IGVycjtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuXG4gICAgICAgICAgICAgIGV4ZWMoXCJjcCAtYSBcIiArIF9fZGlybmFtZSArIFwiL3Z1ZWtpdFwiICsgZGlyKS50aGVuKGZ1bmN0aW9uICgpIHtcblxuXG4gICAgICAgICAgICAgICAgZXhlYyhcImNkIFwiICsgZGlyICsgXCIgbnBtIGlcIikudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImFsbCBkb25lIGZvciBub3dcIilcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICB0aHJvdyBlcnJcbiAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnJcbiAgICAgICAgICAgICAgfSk7XG5cblxuXG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuXG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICB0aHJvdyBlcnI7XG5cbiAgICAgICAgfSlcblxuICAgICAgICBicmVhaztcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgY29uc29sZS5sb2coXCJ0b2Rvb29vXCIpO1xuICAgICAgICBicmVhaztcblxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmxvZyhcIkV4aXQhXCIpO1xuICB9XG5cblxufSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
